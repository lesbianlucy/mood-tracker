name: Femboy Praise

on:
  workflow_run:
    workflows:
      - Code Quality Report
    types:
      - completed

jobs:
  praise:
    if: ${{ github.event.workflow_run.conclusion == 'success' && github.event.workflow_run.pull_requests[0] }}
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      issues: write
    steps:
      - name: Post femboy meme
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const pr = github.event.workflow_run.pull_requests[0];
            if (!pr) {
              core.info('No pull request associated with workflow run.');
              return;
            }

            const messages = [
              `Astolfo approves! ðŸŒ¸âœ¨ You're such a good contributor, cute subby reviewer snack~`,
              `Femboy service announcement: PR spotless, vibes immaculate, ${pr.title} gets cuddles ðŸ’–`,
              `UwU this PR is cleaner than Astolfo's hair. Thanks for being a certified good noodle!`
            ];
            const meme = `![Astolfo High Five](https://i.imgur.com/QfYJwPr.jpeg)`;

            const body = `
            ### âœ… Cozy CI Passed!

            ${messages[Math.floor(Math.random() * messages.length)]}

            ${meme}
            `;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.number,
              body,
            });
